---
layout: post
title: Metis Project 2
---

Our second project for Metis began with only two constraints:
1. Gather a substantial amount of data via web scraping
2. Try to predict a certain target with a linear regression model

Being an aviation enthusiast of many years, I chose to look at a common complaint of many air travelers: delay. Would there perhaps be a way to predict, with any accuracy, the degree to which one might be late on a particular flight?

![AAL 737](http://theflight.info/wp-content/gallery/american-airlines-boeing-737-800/Boeing-737-800-American-Airlines.jpg)

## Approach

I decided to focus first on arrivals at one airport (ORD) from one origin (LGA) operated by one airline (American), and expand from there if I had time. Canceled flights would not be considered. I would collect available arrival information, and calculate "lateness" by subtracting scheduled arrival from actual. This would be a simple measure of minutes, positive if late, and negative if early. Knowing the date would give me the day of the week. It was my hypothesis that some correlation might be found with lateness and both day of week and time of day.  By using these features and others to build a linear regression model, I would see how much truth this held.

## Scraping

Despite all of this information being available in a neatly-wrapped CSV file from the [Bureau of Transportation Statistics](https://www.transtats.bts.gov/ONTIME/Index.aspx), I decided to attempt to scrape data from one of the most popular flight data sites, which shall remain unnamed throughout this discussion. Being a comprehensive trove of proprietary data, this site does not at all want users to scrape its data, and instead wishing them to purchase data over long periods of time for particular flights, airports, routes, etc. Thus, they don't make it easy to scrape.

As much of the data is posted to a particular flight page via javascript, trying to read the page object generated using the requests module with Beautiful Soup is futile. By searching for a particular `class` value, one can navigate to the `div` containing the information of interest, but the `div` contains no text whatsoever.

Before giving up and changing tack, I decided to try Selenium, just in case there might be some luck to be had there. For whatever reason, the page source of the Selenium driver object did contain the desired data (in this case, all the relevant arrival times). Since each page is constructed live from the same template, it was fairly straightforward to use Beautiful Soup to extract the data from there.

Each flight number on each day had its own page, with the date, flight number, and a unique route number comprising elements of the URL. Thus, the scraping function looped through a list of flight number/route number tuples, advancing back into the year one day at a time, manufacturing a URL to hand off to the webdriver for each day until it was detected that there had been no flights for seven consecutive days. In this manner, I was able to collect nearly 2000 records for 17 different flight numbers for anywhere between two and seven months, depending on the flight number.

Further analysis forthcoming.
